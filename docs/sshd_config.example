# QDRIVE MASTER SSHD_CONFIG TEMPLATE
# ==============================================================================

# 1. NETWORK & PORTING
# This port is dynamically managed by Sync-ProtonPort.ps1
Port 22 

# 2. ENCRYPTION & SECURITY (Strict EdDSA/AES-GCM Standards)
KexAlgorithms curve25519-sha256,curve25519-sha256@libssh.org
Ciphers chacha20-poly1305@openssh.com,aes256-gcm@openssh.com,aes256-ctr
MACs hmac-sha2-512-etm@openssh.com,hmac-sha2-256-etm@openssh.com
HostKeyAlgorithms ssh-ed25519,rsa-sha2-512,rsa-sha2-256

# 3. LOGGING
SyslogFacility LOCAL0
LogLevel VERBOSE

# 4. AUTHENTICATION (Keys Only - No Passwords)
PubkeyAuthentication yes
PasswordAuthentication no
PermitEmptyPasswords no
AuthorizedKeysFile .ssh/authorized_keys

# 5. ACCESS CONTROL & CHROOT PORTAL
# Ensure C:/QDRIVE exists and matches your ChrootDirectory
Banner C:/ProgramData/ssh/banner.txt
Subsystem sftp internal-sftp -f LOCAL0 -l VERBOSE

# --- USER: QDRIVEADMIN (SFTP Admin Access) ---
Match User QDRIVEADMIN
      ChrootDirectory C:/QDRIVE
      ForceCommand internal-sftp -f LOCAL0 -l VERBOSE
      AllowTcpForwarding no
      X11Forwarding no
      PermitTTY no
      PasswordAuthentication no
      PubkeyAuthentication yes
      AuthorizedKeysFile C:/Users/QDRIVEADMIN/.ssh/authorized_keys

# --- USER: QDRIVE (Standard SFTP Access) ---
Match User QDRIVE
      ChrootDirectory C:/QDRIVE
      ForceCommand internal-sftp -f LOCAL0 -l VERBOSE
      AllowTcpForwarding no
      X11Forwarding no
      PermitTTY no
      PasswordAuthentication no
      PubkeyAuthentication yes
      AuthorizedKeysFile C:/Users/QDRIVE/.ssh/authorized_keys
